<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Food Tracker - Open Food Facts</title>
<style>
/* –¢–≤–æ–∏ —Å—Ç–∏–ª–∏ (–æ—Å—Ç–∞–≤–ª–µ–Ω—ã –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π) */
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
    background: linear-gradient(135deg, #43cea2 0%, #185a9d 100%);
    min-height: 100vh;
    padding: 20px;
    color: #333;
}

.container {
    max-width: 500px;
    margin: 0 auto;
    background: white;
    border-radius: 20px;
    box-shadow: 0 20px 60px rgba(0,0,0,0.3);
    overflow: hidden;
    animation: slideIn 0.3s ease-out;
}

@keyframes slideIn {
    from {
        opacity: 0;
        transform: translateY(20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.header {
    background: linear-gradient(135deg, #43cea2 0%, #185a9d 100%);
    color: white;
    padding: 25px;
    text-align: center;
}

.header h1 {
    font-size: 28px;
    margin-bottom: 10px;
}

.stats-row {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 15px;
    padding: 20px;
    background: #f8f9fa;
}

.stat-card {
    background: white;
    padding: 15px;
    border-radius: 15px;
    text-align: center;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
}

.stat-card .value {
    font-size: 32px;
    font-weight: bold;
    color: #43cea2;
    cursor: pointer;
}

.stat-card .label {
    font-size: 12px;
    color: #666;
    margin-top: 5px;
}

.progress-bar {
    width: 100%;
    height: 8px;
    background: #e0e0e0;
    border-radius: 4px;
    margin-top: 10px;
    overflow: hidden;
}

.progress-fill {
    height: 100%;
    background: linear-gradient(90deg, #43cea2, #185a9d);
    border-radius: 4px;
    transition: width 0.3s ease;
}

.input-section {
    padding: 20px;
}

.search-wrapper {
    position: relative;
    margin-bottom: 15px;
}

.search-input {
    width: 100%;
    padding: 15px 50px 15px 15px;
    border: 2px solid #e0e0e0;
    border-radius: 15px;
    font-size: 16px;
    transition: all 0.3s ease;
}

.search-input:focus {
    outline: none;
    border-color: #43cea2;
    box-shadow: 0 0 0 3px rgba(67, 206, 162, 0.1);
}

.search-button {
    position: absolute;
    right: 5px;
    top: 50%;
    transform: translateY(-50%);
    background: linear-gradient(135deg, #43cea2 0%, #185a9d 100%);
    color: white;
    border: none;
    width: 40px;
    height: 40px;
    border-radius: 10px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: transform 0.2s ease;
}

.search-button:hover {
    transform: translateY(-50%) scale(1.1);
}

.search-button.loading {
    animation: pulse 1s infinite;
}

@keyframes pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.5; }
}

.barcode-section {
    padding: 0 20px 20px;
    display: flex;
    gap: 10px;
}

.barcode-input {
    flex: 1;
    padding: 12px;
    border: 2px solid #e0e0e0;
    border-radius: 10px;
    font-size: 14px;
}

.barcode-btn {
    padding: 12px 20px;
    background: #ff9800;
    color: white;
    border: none;
    border-radius: 10px;
    font-weight: bold;
    cursor: pointer;
    transition: all 0.2s ease;
}

.barcode-btn:hover {
    background: #f57c00;
    transform: translateY(-2px);
}

.search-results {
    max-height: 300px;
    overflow-y: auto;
    margin: 0 20px 20px;
    border: 2px solid #e0e0e0;
    border-radius: 15px;
    display: none;
}

.search-results.active {
    display: block;
}

.result-item {
    padding: 15px;
    border-bottom: 1px solid #e0e0e0;
    cursor: pointer;
    transition: background 0.2s ease;
}

.result-item:hover {
    background: #f0f8f5;
}

.result-item:last-child {
    border-bottom: none;
}

.result-name {
    font-weight: 600;
    color: #333;
    margin-bottom: 5px;
}

.result-brand {
    font-size: 12px;
    color: #666;
    margin-bottom: 5px;
}

.result-nutrition {
    font-size: 12px;
    color: #43cea2;
}

.manual-add-section {
    padding: 20px;
    background: #f8f9fa;
    border-top: 1px solid #e0e0e0;
}

.manual-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 10px;
    margin-bottom: 15px;
}

.manual-input {
    padding: 10px;
    border: 2px solid #e0e0e0;
    border-radius: 10px;
    font-size: 14px;
}

.manual-input:focus {
    outline: none;
    border-color: #43cea2;
}

.add-manual-btn {
    width: 100%;
    padding: 12px;
    background: linear-gradient(135deg, #43cea2 0%, #185a9d 100%);
    color: white;
    border: none;
    border-radius: 10px;
    font-weight: bold;
    cursor: pointer;
    transition: all 0.2s ease;
}

.add-manual-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(67, 206, 162, 0.3);
}

.quick-add-section {
    padding: 20px;
    border-top: 1px solid #e0e0e0;
}

.quick-add-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 10px;
    margin-top: 15px;
}

.quick-btn {
    padding: 12px;
    background: #f8f9fa;
    border: 2px solid #e0e0e0;
    border-radius: 10px;
    font-size: 14px;
    cursor: pointer;
    transition: all 0.2s ease;
}

.quick-btn:hover {
    background: #43cea2;
    color: white;
    border-color: #43cea2;
    transform: translateY(-2px);
}

.food-list {
    padding: 20px;
    max-height: 400px;
    overflow-y: auto;
}

.food-item {
    background: #f8f9fa;
    padding: 15px;
    border-radius: 15px;
    margin-bottom: 10px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    animation: slideIn 0.3s ease-out;
}

.food-info {
    flex: 1;
}

.food-name {
    font-weight: 600;
    color: #333;
    margin-bottom: 5px;
}

.food-details {
    font-size: 12px;
    color: #666;
}

.food-calories {
    font-size: 20px;
    font-weight: bold;
    color: #43cea2;
    margin-right: 10px;
}

.delete-btn {
    background: #f44336;
    color: white;
    border: none;
    width: 30px;
    height: 30px;
    border-radius: 50%;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: transform 0.2s ease;
}

.delete-btn:hover {
    transform: scale(1.1);
}

.message {
    padding: 15px;
    margin: 15px 20px;
    border-radius: 10px;
    animation: slideIn 0.3s ease-out;
}

.message.success {
    background: #e8f5e9;
    border: 2px solid #4caf50;
    color: #2e7d32;
}

.message.error {
    background: #ffebee;
    border: 2px solid #f44336;
    color: #c62828;
}

.message.info {
    background: #e3f2fd;
    border: 2px solid #2196f3;
    color: #1565c0;
}

.tabs {
    display: flex;
    padding: 20px 20px 0;
    gap: 10px;
}

.tab {
    flex: 1;
    padding: 12px;
    background: #f8f9fa;
    border: none;
    border-radius: 10px 10px 0 0;
    cursor: pointer;
    font-weight: 600;
    color: #666;
    transition: all 0.2s ease;
}

.tab.active {
    background: white;
    color: #43cea2;
}

.tab-content {
    display: none;
}

.tab-content.active {
    display: block;
}
</style>
</head>
<body>
<div class="container">
    <div class="header">
        <h1>ü•ó Food Tracker</h1>
        <div class="date" id="currentDate"></div>
        <div style="margin-top: 10px; font-size: 12px; opacity: 0.9;">
            Powered by Open Food Facts
        </div>
    </div>

    <div class="stats-row">
        <div class="stat-card">
            <div class="value" id="totalCalories">0</div>
            <div class="label">–ö–∞–ª–æ—Ä–∏–π —Å–µ–≥–æ–¥–Ω—è</div>
        </div>
        <div class="stat-card">
            <div class="value" id="dailyGoal" style="cursor:pointer;" onclick="changeDailyGoal()">2000</div>
            <div class="label">–î–Ω–µ–≤–Ω–∞—è —Ü–µ–ª—å (–∫–ª–∏–∫–Ω–∏ –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è)</div>
            <div class="progress-bar">
                <div class="progress-fill" id="progressBar"></div>
            </div>
        </div>
    </div>

    <div class="tabs">
        <button class="tab active" onclick="switchTab('search')">üîç –ü–æ–∏—Å–∫</button>
        <button class="tab" onclick="switchTab('local')">üìã –ë–∞–∑–∞</button>
        <button class="tab" onclick="switchTab('manual')">‚úèÔ∏è –í—Ä—É—á–Ω—É—é</button>
    </div>

    <!-- –ü–æ–∏—Å–∫ -->
    <div id="searchTab" class="tab-content active">
        <div class="input-section">
            <h3>–ü–æ–∏—Å–∫ –ø—Ä–æ–¥—É–∫—Ç–∞</h3>
            <div class="search-wrapper">
                <input type="text" class="search-input" id="searchInput" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–∞ –∏–ª–∏ –±—Ä–µ–Ω–¥...">
                <button class="search-button" id="searchButton" onclick="searchProducts()">
                    <span id="searchIcon">üîç</span>
                </button>
            </div>
        </div>

        <!-- –ù–æ–≤—ã–π –±—ã—Å—Ç—Ä—ã–π –≤–≤–æ–¥ -->
        <div class="input-section">
            <h3>–ë—ã—Å—Ç—Ä—ã–π –≤–≤–æ–¥ —Ñ—Ä–∞–∑—ã</h3>
            <input type="text" class="search-input" id="phraseInput" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 200 –≥ –≥—Ä–µ—á–∫–∏ –∏ 2 –±–ª–∏–Ω–∞ —Å —Å—ã—Ä–æ–º">
            <button class="search-button" style="right:5px;" onclick="parseFoodPhrase()">‚ûï</button>
        </div>

        <div class="barcode-section">
            <input type="text" class="barcode-input" id="barcodeInput" placeholder="–®—Ç—Ä–∏—Ö-–∫–æ–¥ –ø—Ä–æ–¥—É–∫—Ç–∞">
            <button class="barcode-btn" onclick="searchByBarcode()">üì∑ –ù–∞–π—Ç–∏</button>
        </div>

        <div id="searchResults" class="search-results"></div>
    </div>

    <!-- –õ–æ–∫–∞–ª—å–Ω–∞—è –±–∞–∑–∞ -->
    <div id="localTab" class="tab-content">
        <div class="local-products" id="localProducts"></div>
    </div>

    <!-- –†—É—á–Ω–æ–π –≤–≤–æ–¥ -->
    <div id="manualTab" class="tab-content">
        <div class="manual-add-section">
            <h3>–î–æ–±–∞–≤–∏—Ç—å –≤—Ä—É—á–Ω—É—é</h3>
            <div class="manual-grid">
                <input type="text" class="manual-input" id="manualName" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ">
                <input type="number" class="manual-input" id="manualCalories" placeholder="–ö–∞–ª–æ—Ä–∏–∏">
                <input type="number" class="manual-input" id="manualWeight" placeholder="–í–µ—Å (–≥)">
                <input type="number" class="manual-input" id="manualProteins" placeholder="–ë–µ–ª–∫–∏ (–≥)">
                <input type="number" class="manual-input" id="manualFats" placeholder="–ñ–∏—Ä—ã (–≥)">
                <input type="number" class="manual-input" id="manualCarbs" placeholder="–£–≥–ª–µ–≤–æ–¥—ã (–≥)">
            </div>
            <button class="add-manual-btn" onclick="addManualFood()">–î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–¥—É–∫—Ç</button>
        </div>
    </div>

    <div class="quick-add-section">
        <h3>–ë—ã—Å—Ç—Ä–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ</h3>
        <div class="quick-add-grid">
            <button class="quick-btn" onclick="quickSearch('—è–±–ª–æ–∫–æ')">üçé –Ø–±–ª–æ–∫–æ</button>
            <button class="quick-btn" onclick="quickSearch('–±–∞–Ω–∞–Ω')">üçå –ë–∞–Ω–∞–Ω</button>
            <button class="quick-btn" onclick="quickSearch('–º–æ–ª–æ–∫–æ')">ü•õ –ú–æ–ª–æ–∫–æ</button>
            <button class="quick-btn" onclick="quickSearch('—Ö–ª–µ–±')">üçû –•–ª–µ–±</button>
            <button class="quick-btn" onclick="quickSearch('–∫—É—Ä–∏—Ü–∞')">üçó –ö—É—Ä–∏—Ü–∞</button>
            <button class="quick-btn" onclick="quickSearch('—Ä–∏—Å')">üçö –†–∏—Å</button>
        </div>
    </div>

    <div id="messageArea"></div>
    <div class="food-list" id="foodList"></div>
</div>

<script>
// –õ–æ–∫–∞–ª—å–Ω–∞—è –±–∞–∑–∞ –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö –ø—Ä–æ–¥—É–∫—Ç–æ–≤ (–Ω–∞ 100–≥)
const localDatabase = {
    '–Ø–±–ª–æ–∫–æ': { calories: 52, proteins: 0.3, fats: 0.2, carbs: 14 },
    '–ë–∞–Ω–∞–Ω': { calories: 89, proteins: 1.1, fats: 0.3, carbs: 23 },
    '–ê–ø–µ–ª—å—Å–∏–Ω': { calories: 47, proteins: 0.9, fats: 0.1, carbs: 12 },
    '–ì—Ä—É—à–∞': { calories: 57, proteins: 0.4, fats: 0.1, carbs: 15 },
    '–í–∏–Ω–æ–≥—Ä–∞–¥': { calories: 67, proteins: 0.6, fats: 0.2, carbs: 17 },
    '–ö–ª—É–±–Ω–∏–∫–∞': { calories: 32, proteins: 0.7, fats: 0.3, carbs: 8 },
    '–ê—Ä–±—É–∑': { calories: 30, proteins: 0.6, fats: 0.2, carbs: 8 },
    '–î—ã–Ω—è': { calories: 34, proteins: 0.8, fats: 0.2, carbs: 8 },
    '–ü–æ–º–∏–¥–æ—Ä': { calories: 18, proteins: 0.9, fats: 0.2, carbs: 3.9 },
    '–û–≥—É—Ä–µ—Ü': { calories: 16, proteins: 0.7, fats: 0.1, carbs: 3.6 },
    '–ú–æ—Ä–∫–æ–≤—å': { calories: 41, proteins: 0.9, fats: 0.2, carbs: 10 },
    '–ö–∞–ø—É—Å—Ç–∞': { calories: 25, proteins: 1.3, fats: 0.1, carbs: 6 },
    '–ö–∞—Ä—Ç–æ—Ñ–µ–ª—å': { calories: 77, proteins: 2, fats: 0.1, carbs: 17 },
    '–°–≤–µ–∫–ª–∞': { calories: 43, proteins: 1.6, fats: 0.2, carbs: 10 },
    '–õ—É–∫': { calories: 40, proteins: 1.1, fats: 0.1, carbs: 9 },
    '–ß–µ—Å–Ω–æ–∫': { calories: 149, proteins: 6.4, fats: 0.5, carbs: 33 },
    '–ú–æ–ª–æ–∫–æ 3.2%': { calories: 59, proteins: 2.9, fats: 3.2, carbs: 4.7 },
    '–ö–µ—Ñ–∏—Ä 2.5%': { calories: 50, proteins: 2.8, fats: 2.5, carbs: 3.9 },
    '–¢–≤–æ—Ä–æ–≥ 5%': { calories: 121, proteins: 17, fats: 5, carbs: 1.8 },
    '–¢–≤–æ—Ä–æ–≥ 0%': { calories: 71, proteins: 16, fats: 0, carbs: 1.3 },
    '–°–º–µ—Ç–∞–Ω–∞ 20%': { calories: 206, proteins: 2.8, fats: 20, carbs: 3.2 },
    '–°—ã—Ä —Ç–≤–µ—Ä–¥—ã–π': { calories: 363, proteins: 24, fats: 29, carbs: 0.3 },
    '–ô–æ–≥—É—Ä—Ç –Ω–∞—Ç—É—Ä–∞–ª—å–Ω—ã–π': { calories: 61, proteins: 3.5, fats: 3.3, carbs: 4.7 },
    '–†—è–∂–µ–Ω–∫–∞': { calories: 67, proteins: 2.8, fats: 4, carbs: 4.2 },
    '–ö—É—Ä–∏—Ü–∞ –≥—Ä—É–¥–∫–∞': { calories: 165, proteins: 31, fats: 3.6, carbs: 0 },
    '–ö—É—Ä–∏—Ü–∞ –±–µ–¥—Ä–æ': { calories: 221, proteins: 18, fats: 16, carbs: 0 },
    '–ì–æ–≤—è–¥–∏–Ω–∞': { calories: 250, proteins: 26, fats: 15, carbs: 0 },
    '–°–≤–∏–Ω–∏–Ω–∞': { calories: 242, proteins: 27, fats: 14, carbs: 0 },
    '–ò–Ω–¥–µ–π–∫–∞': { calories: 189, proteins: 29, fats: 7, carbs: 0 },
    '–ë–∞—Ä–∞–Ω–∏–Ω–∞': { calories: 294, proteins: 25, fats: 21, carbs: 0 },
    '–õ–æ—Å–æ—Å—å': { calories: 208, proteins: 20, fats: 13, carbs: 0 },
    '–¢—Ä–µ—Å–∫–∞': { calories: 82, proteins: 18, fats: 0.7, carbs: 0 },
    '–°–∫—É–º–±—Ä–∏—è': { calories: 205, proteins: 19, fats: 14, carbs: 0 },
    '–¢—É–Ω–µ—Ü': { calories: 144, proteins: 23, fats: 5, carbs: 0 },
    '–ú–∏–Ω—Ç–∞–π': { calories: 72, proteins: 16, fats: 0.9, carbs: 0 },
    '–ì—Ä–µ—á–∫–∞ –≤–∞—Ä–µ–Ω–∞—è': { calories: 92, proteins: 3.4, fats: 0.6, carbs: 20 },
    '–†–∏—Å –≤–∞—Ä–µ–Ω—ã–π': { calories: 130, proteins: 2.7, fats: 0.3, carbs: 28 },
    '–û–≤—Å—è–Ω–∫–∞ –≤–∞—Ä–µ–Ω–∞—è': { calories: 71, proteins: 2.5, fats: 1.4, carbs: 12 },
    '–ú–∞–∫–∞—Ä–æ–Ω—ã –≤–∞—Ä–µ–Ω—ã–µ': { calories: 131, proteins: 5, fats: 0.9, carbs: 25 },
    '–ü–µ—Ä–ª–æ–≤–∫–∞ –≤–∞—Ä–µ–Ω–∞—è': { calories: 123, proteins: 2.3, fats: 0.4, carbs: 28 },
    '–•–ª–µ–± –±–µ–ª—ã–π': { calories: 265, proteins: 9, fats: 3.2, carbs: 49 },
    '–•–ª–µ–± —á–µ—Ä–Ω—ã–π': { calories: 201, proteins: 6.6, fats: 1.2, carbs: 40 },
    '–•–ª–µ–± —Ü–µ–ª—å–Ω–æ–∑–µ—Ä–Ω–æ–≤–æ–π': { calories: 247, proteins: 13, fats: 3.4, carbs: 41 },
    '–Ø–π—Ü–æ –∫—É—Ä–∏–Ω–æ–µ': { calories: 155, proteins: 13, fats: 11, carbs: 1.1 },
    '–Ø–π—Ü–æ –ø–µ—Ä–µ–ø–µ–ª–∏–Ω–æ–µ': { calories: 158, proteins: 13, fats: 11, carbs: 0.4 },
    '–ì—Ä–µ—Ü–∫–∏–π –æ—Ä–µ—Ö': { calories: 654, proteins: 15, fats: 65, carbs: 14 },
    '–ú–∏–Ω–¥–∞–ª—å': { calories: 579, proteins: 21, fats: 50, carbs: 22 },
    '–§—É–Ω–¥—É–∫': { calories: 628, proteins: 15, fats: 61, carbs: 17 },
    '–ö–µ—à—å—é': { calories: 553, proteins: 18, fats: 44, carbs: 30 },
    '–ë–æ—Ä—â': { calories: 49, proteins: 1.1, fats: 2.2, carbs: 6.7 },
    '–©–∏': { calories: 31, proteins: 1.7, fats: 1.1, carbs: 3.8 },
    '–°–∞–ª–∞—Ç –û–ª–∏–≤—å–µ': { calories: 198, proteins: 5.5, fats: 16, carbs: 7 },
    '–°–∞–ª–∞—Ç –¶–µ–∑–∞—Ä—å': { calories: 301, proteins: 15, fats: 17, carbs: 24 },
    '–ü–µ–ª—å–º–µ–Ω–∏': { calories: 275, proteins: 12, fats: 12, carbs: 29 },
    '–ë–ª–∏–Ω—ã': { calories: 227, proteins: 6.1, fats: 12, carbs: 26 },
    '–ö–∞—à–∞ –≥—Ä–µ—á–Ω–µ–≤–∞—è': { calories: 132, proteins: 4.5, fats: 2.3, carbs: 25 },
    '–ü—é—Ä–µ –∫–∞—Ä—Ç–æ—Ñ–µ–ª—å–Ω–æ–µ': { calories: 88, proteins: 2, fats: 0.8, carbs: 19 }
};

let todaysFoods = [];
let dailyGoal = 2000;
let currentTab = 'search';

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
window.onload = function() {
    loadTodaysData();

    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–µ–∫—É—â—É—é –¥–∞—Ç—É
    const today = new Date();
    document.getElementById('currentDate').textContent = today.toLocaleDateString('ru-RU', {
        weekday: 'long',
        year: 'numeric',
        month: 'long',
        day: 'numeric'
    });

    // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
    updateStats();

    // –ó–∞–≥—Ä—É–∂–∞–µ–º –ª–æ–∫–∞–ª—å–Ω—É—é –±–∞–∑—É
    loadLocalProducts();
};

function switchTab(tab) {
    currentTab = tab;

    // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—É—é –≤–∫–ª–∞–¥–∫—É
    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
    document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));

    if (tab === 'search') {
        document.querySelectorAll('.tab')[0].classList.add('active');
        document.getElementById('searchTab').classList.add('active');
    } else if (tab === 'local') {
        document.querySelectorAll('.tab')[1].classList.add('active');
        document.getElementById('localTab').classList.add('active');
    } else if (tab === 'manual') {
        document.querySelectorAll('.tab')[2].classList.add('active');
        document.getElementById('manualTab').classList.add('active');
    }
}

function loadLocalProducts() {
    const container = document.getElementById('localProducts');
    container.innerHTML = Object.entries(localDatabase).map(([name, data]) => `
        <div class="local-product" onclick="addLocalProduct('${name}')">
            <div class="local-product-name">${name}</div>
            <div class="local-product-cal">${data.calories} –∫–∫–∞–ª/100–≥</div>
        </div>
    `).join('');
}

function addLocalProduct(name) {
    const product = localDatabase[name];
    if (product) {
        // –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ
        const weight = prompt(`–í–≤–µ–¥–∏—Ç–µ –≤–µ—Å –ø–æ—Ä—Ü–∏–∏ ${name} –≤ –≥—Ä–∞–º–º–∞—Ö:`, '100');
        if (weight && !isNaN(weight)) {
            const multiplier = parseFloat(weight) / 100;
            const food = {
                name: name,
                calories: Math.round(product.calories * multiplier),
                proteins: Math.round(product.proteins * multiplier * 10) / 10,
                fats: Math.round(product.fats * multiplier * 10) / 10,
                carbs: Math.round(product.carbs * multiplier * 10) / 10,
                weight: parseFloat(weight),
                id: Date.now(),
                time: new Date().toLocaleTimeString('ru-RU', { hour: '2-digit', minute: '2-digit' })
            };

            todaysFoods.push(food);
            saveTodaysData();
            updateStats();
            renderFoodList();
            showMessage(`‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ: ${name} (${weight}–≥)`, 'success');
        }
    }
}

async function searchProducts() {
    const query = document.getElementById('searchInput').value.trim();
    if (!query) {
        showMessage('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–∞', 'error');
        return;
    }

    const button = document.getElementById('searchButton');
    const icon = document.getElementById('searchIcon');

    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É
    button.classList.add('loading');
    icon.textContent = '‚è≥';

    try {
        // API Open Food Facts –¥–ª—è –ø–æ–∏—Å–∫–∞
        const response = await fetch(`https://world.openfoodfacts.org/cgi/search.pl?search_terms=${encodeURIComponent(query)}&search_simple=1&action=process&json=1&page_size=10&page=1&fields=product_name,brands,nutriments,quantity`);

        if (!response.ok) throw new Error('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏');

        const data = await response.json();

        if (data.products && data.products.length > 0) {
            displaySearchResults(data.products);
        } else {
            // –ï—Å–ª–∏ –Ω–µ –Ω–∞—à–ª–∏ –≤ API, –∏—â–µ–º –≤ –ª–æ–∫–∞–ª—å–Ω–æ–π –±–∞–∑–µ
            const localResults = searchLocalDatabase(query);
            if (localResults.length > 0) {
                displayLocalResults(localResults);
            } else {
                showMessage('–ü—Ä–æ–¥—É–∫—Ç—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –¥—Ä—É–≥–æ–π –∑–∞–ø—Ä–æ—Å –∏–ª–∏ –¥–æ–±–∞–≤—å—Ç–µ –≤—Ä—É—á–Ω—É—é.', 'info');
            }
        }

    } catch (error) {
        console.error('Error:', error);
        // –ü—Ä–∏ –æ—à–∏–±–∫–µ API –∏—Å–ø–æ–ª—å–∑—É–µ–º –ª–æ–∫–∞–ª—å–Ω—É—é –±–∞–∑—É
        const localResults = searchLocalDatabase(query);
        if (localResults.length > 0) {
            displayLocalResults(localResults);
        } else {
            showMessage('–û—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –¥–æ–±–∞–≤–∏—Ç—å –≤—Ä—É—á–Ω—É—é.', 'error');
        }
    } finally {
        button.classList.remove('loading');
        icon.textContent = 'üîç';
    }
}

function searchLocalDatabase(query) {
    const searchTerm = query.toLowerCase();
    return Object.entries(localDatabase)
        .filter(([name]) => name.toLowerCase().includes(searchTerm))
        .map(([name, data]) => ({ name, ...data }));
}

function displayLocalResults(results) {
    const container = document.getElementById('searchResults');
    container.innerHTML = results.map(product => `
        <div class="result-item" onclick="selectLocalProduct('${product.name}')">
            <div class="result-name">${product.name}</div>
            <div class="result-brand">–ò–∑ –ª–æ–∫–∞–ª—å–Ω–æ–π –±–∞–∑—ã</div>
            <div class="result-nutrition">
                ${product.calories} –∫–∫–∞–ª/100–≥ | 
                –ë: ${product.proteins}–≥ | 
                –ñ: ${product.fats}–≥ | 
                –£: ${product.carbs}–≥
            </div>
        </div>
    `).join('');
    container.classList.add('active');
}

function selectLocalProduct(name) {
    addLocalProduct(name);
    document.getElementById('searchResults').classList.remove('active');
    document.getElementById('searchInput').value = '';
}

function displaySearchResults(products) {
    const container = document.getElementById('searchResults');

    container.innerHTML = products.map(product => {
        const name = product.product_name || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è';
        const brand = product.brands || '';
        const nutrients = product.nutriments || {};
        const calories = Math.round(nutrients['energy-kcal'] || nutrients.energy || 0);
        const proteins = Math.round((nutrients.proteins || 0) * 10) / 10;
        const fats = Math.round((nutrients.fat || 0) * 10) / 10;
        const carbs = Math.round((nutrients.carbohydrates || 0) * 10) / 10;

        return `
            <div class="result-item" onclick='selectProduct(${JSON.stringify({
                name: name.replace(/'/g, "\\'"),
                brand: brand.replace(/'/g, "\\'"),
                calories: calories,
                proteins: proteins,
                fats: fats,
                carbs: carbs
            })})'>
                <div class="result-name">${name}</div>
                ${brand ? `<div class="result-brand">${brand}</div>` : ''}
                <div class="result-nutrition">
                    ${calories} –∫–∫–∞–ª/100–≥ | 
                    –ë: ${proteins}–≥ | 
                    –ñ: ${fats}–≥ | 
                    –£: ${carbs}–≥
                </div>
            </div>
        `;
    }).join('');

    container.classList.add('active');
}

function selectProduct(product) {
    // –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ
    const weight = prompt(`–í–≤–µ–¥–∏—Ç–µ –≤–µ—Å –ø–æ—Ä—Ü–∏–∏ "${product.name}" –≤ –≥—Ä–∞–º–º–∞—Ö:`, '100');
    if (weight && !isNaN(weight)) {
        const multiplier = parseFloat(weight) / 100;
        const food = {
            name: product.brand ? `${product.name} (${product.brand})` : product.name,
            calories: Math.round(product.calories * multiplier),
            proteins: Math.round(product.proteins * multiplier * 10) / 10,
            fats: Math.round(product.fats * multiplier * 10) / 10,
            carbs: Math.round(product.carbs * multiplier * 10) / 10,
            weight: parseFloat(weight),
            id: Date.now(),
            time: new Date().toLocaleTimeString('ru-RU', { hour: '2-digit', minute: '2-digit' })
        };

        todaysFoods.push(food);
        saveTodaysData();
        updateStats();
        renderFoodList();

        // –û—á–∏—â–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞
        document.getElementById('searchResults').classList.remove('active');
        document.getElementById('searchInput').value = '';

        showMessage(`‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ: ${food.name}`, 'success');
    }
}

async function searchByBarcode() {
    const barcode = document.getElementById('barcodeInput').value.trim();
    if (!barcode) {
        showMessage('–í–≤–µ–¥–∏—Ç–µ —à—Ç—Ä–∏—Ö-–∫–æ–¥', 'error');
        return;
    }

    try {
        const response = await fetch(`https://world.openfoodfacts.org/api/v0/product/${barcode}.json`);
        const data = await response.json();

        if (data.status === 1 && data.product) {
            const product = data.product;
            const nutrients = product.nutriments || {};

            selectProduct({
                name: product.product_name || '–ü—Ä–æ–¥—É–∫—Ç',
                brand: product.brands || '',
                calories: Math.round(nutrients['energy-kcal'] || nutrients.energy || 0),
                proteins: Math.round((nutrients.proteins || 0) * 10) / 10,
                fats: Math.round((nutrients.fat || 0) * 10) / 10,
                carbs: Math.round((nutrients.carbohydrates || 0) * 10) / 10
            });

            document.getElementById('barcodeInput').value = '';
        } else {
            showMessage('–ü—Ä–æ–¥—É–∫—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω –ø–æ —à—Ç—Ä–∏—Ö-–∫–æ–¥—É', 'error');
        }
    } catch (error) {
        console.error('Error:', error);
        showMessage('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–∏—Å–∫–µ –ø–æ —à—Ç—Ä–∏—Ö-–∫–æ–¥—É', 'error');
    }
}

function addManualFood() {
    const name = document.getElementById('manualName').value.trim();
    const calories = parseFloat(document.getElementById('manualCalories').value) || 0;
    const weight = parseFloat(document.getElementById('manualWeight').value) || 100;
    const proteins = parseFloat(document.getElementById('manualProteins').value) || 0;
    const fats = parseFloat(document.getElementById('manualFats').value) || 0;
    const carbs = parseFloat(document.getElementById('manualCarbs').value) || 0;

    if (!name) {
        showMessage('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–∞', 'error');
        return;
    }

    const food = {
        name: name,
        calories: Math.round(calories),
        proteins: Math.round(proteins * 10) / 10,
        fats: Math.round(fats * 10) / 10,
        carbs: Math.round(carbs * 10) / 10,
        weight: weight,
        id: Date.now(),
        time: new Date().toLocaleTimeString('ru-RU', { hour: '2-digit', minute: '2-digit' })
    };

    todaysFoods.push(food);
    saveTodaysData();
    updateStats();
    renderFoodList();

    // –û—á–∏—â–∞–µ–º —Ñ–æ—Ä–º—É
    document.getElementById('manualName').value = '';
    document.getElementById('manualCalories').value = '';
    document.getElementById('manualWeight').value = '';
    document.getElementById('manualProteins').value = '';
    document.getElementById('manualFats').value = '';
    document.getElementById('manualCarbs').value = '';

    showMessage(`‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ: ${name}`, 'success');
}

function quickSearch(query) {
    document.getElementById('searchInput').value = query;
    searchProducts();
}

function renderFoodList() {
    const listDiv = document.getElementById('foodList');

    if (todaysFoods.length === 0) {
        listDiv.innerHTML = '<p style="text-align: center; color: #999;">–ù–µ—Ç –∑–∞–ø–∏—Å–µ–π –∑–∞ —Å–µ–≥–æ–¥–Ω—è</p>';
        return;
    }

    listDiv.innerHTML = todaysFoods.map(food => `
        <div class="food-item">
            <div class="food-info">
                <div class="food-name">${food.name}</div>
                <div class="food-details">
                    ${food.time} | ${food.weight}–≥ | –ë: ${food.proteins}–≥, –ñ: ${food.fats}–≥, –£: ${food.carbs}–≥
                </div>
            </div>
            <div class="food-calories">${food.calories}</div>
            <button class="delete-btn" onclick="deleteFood(${food.id})">√ó</button>
        </div>
    `).join('');
}

function deleteFood(id) {
    todaysFoods = todaysFoods.filter(f => f.id !== id);
    saveTodaysData();
    updateStats();
    renderFoodList();
}

function updateStats() {
    const totalCalories = todaysFoods.reduce((sum, food) => sum + food.calories, 0);
    document.getElementById('totalCalories').textContent = totalCalories;

    const progress = Math.min((totalCalories / dailyGoal) * 100, 100);
    const progressBar = document.getElementById('progressBar');
    progressBar.style.width = progress + '%';

    // –ú–µ–Ω—è–µ–º —Ü–≤–µ—Ç –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä–∞
    if (progress > 110) {
        progressBar.style.background = 'linear-gradient(90deg, #f44336, #ff6b6b)';
    } else if (progress > 90) {
        progressBar.style.background = 'linear-gradient(90deg, #ff9800, #ffc107)';
    } else {
        progressBar.style.background = 'linear-gradient(90deg, #43cea2, #185a9d)';
    }
}

function saveTodaysData() {
    const today = new Date().toDateString();
    localStorage.setItem(`foods_${today}`, JSON.stringify(todaysFoods));
}

function loadTodaysData() {
    const today = new Date().toDateString();
    const saved = localStorage.getItem(`foods_${today}`);
    if (saved) {
        todaysFoods = JSON.parse(saved);
        renderFoodList();
    }

    // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ü–µ–ª—å
    const savedGoal = localStorage.getItem('daily_goal');
    if (savedGoal) {
        dailyGoal = parseInt(savedGoal);
        document.getElementById('dailyGoal').textContent = dailyGoal;
    }
}

function showMessage(text, type) {
    const messageArea = document.getElementById('messageArea');
    messageArea.innerHTML = `<div class="message ${type}">${text}</div>`;

    setTimeout(() => {
        messageArea.innerHTML = '';
    }, 3000);
}

// –û–±—Ä–∞–±–æ—Ç–∫–∞ Enter –≤ –ø–æ–ª–µ –ø–æ–∏—Å–∫–∞
document.getElementById('searchInput').addEventListener('keypress', function(e) {
    if (e.key === 'Enter') {
        searchProducts();
    }
});

// –û–±—Ä–∞–±–æ—Ç–∫–∞ Enter –≤ –ø–æ–ª–µ —à—Ç—Ä–∏—Ö-–∫–æ–¥–∞
document.getElementById('barcodeInput').addEventListener('keypress', function(e) {
    if (e.key === 'Enter') {
        searchByBarcode();
    }
});

// ====== –ü–∞—Ä—Å–µ—Ä —Ñ—Ä–∞–∑ ======
const defaultWeights = {
    "–ë–ª–∏–Ω—ã": 50,
    "–ë–ª–∏–Ω": 50,
    "–Ø–π—Ü–æ –∫—É—Ä–∏–Ω–æ–µ": 60,
    "–•–ª–µ–± –±–µ–ª—ã–π": 30,
    "–•–ª–µ–± —á–µ—Ä–Ω—ã–π": 30
};

function parseFoodPhrase() {
    let phrase = document.getElementById("phraseInput").value.trim().toLowerCase();
    if (!phrase) {
        showMessage("–í–≤–µ–¥–∏—Ç–µ —Ñ—Ä–∞–∑—É", "error");
        return;
    }

    let addedCount = 0;

    for (let name in localDatabase) {
        let loweredName = name.toLowerCase();

        // –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –ø–∞–¥–µ–∂–∏ (–ø–æ–∏—Å–∫ –ø–æ –∫–æ—Ä–Ω—é —Å–ª–æ–≤–∞)
        if (phrase.includes(loweredName) || phrase.includes(loweredName.split(" ")[0])) {
            // –∏—â–µ–º –≤–µ—Å
            let regex = new RegExp(`(\\d+)\\s*–≥(—Ä–∞–º–º|—Ä)?\\s*${loweredName}`);
            let match = phrase.match(regex);
            let weight;

            if (match) {
                weight = parseInt(match[1]);
            } else {
                // –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —à—Ç—É–∫–∏
                let pieceMatch = phrase.match(new RegExp(`(\\d+)\\s*(—à—Ç—É–∫|—à—Ç—É–∫–∏|—à—Ç|${loweredName})`));
                if (pieceMatch && defaultWeights[name]) {
                    weight = parseInt(pieceMatch[1]) * defaultWeights[name];
                } else {
                    // –¥–µ—Ñ–æ–ª—Ç 100 –≥
                    weight = defaultWeights[name] || 100;
                }
            }

            addLocalProductWithWeight(name, weight);
            addedCount++;
        }
    }

    if (addedCount === 0) {
        showMessage("–ù–µ —É–¥–∞–ª–æ—Å—å —Ä–∞—Å–ø–æ–∑–Ω–∞—Ç—å –ø—Ä–æ–¥—É–∫—Ç—ã", "error");
    } else {
        document.getElementById("phraseInput").value = "";
    }
}

function addLocalProductWithWeight(name, weight) {
    const product = localDatabase[name];
    if (product) {
        const multiplier = weight / 100;
        const food = {
            name: name,
            calories: Math.round(product.calories * multiplier),
            proteins: +(product.proteins * multiplier).toFixed(1),
            fats: +(product.fats * multiplier).toFixed(1),
            carbs: +(product.carbs * multiplier).toFixed(1),
            weight,
            id: Date.now(),
            time: new Date().toLocaleTimeString('ru-RU', { hour: '2-digit', minute: '2-digit' })
        };
        todaysFoods.push(food);
        saveTodaysData();
        updateStats();
        renderFoodList();
        showMessage(`‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ: ${name} (${weight}–≥)`, "success");
    }
}
</script>
</body>
</html>
