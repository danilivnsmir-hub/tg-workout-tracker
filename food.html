<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Food Tracker - Telegram App</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
    * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    -webkit-tap-highlight-color: transparent;
    }

    body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
    background: var(--tg-theme-bg-color, #ffffff);
    color: var(--tg-theme-text-color, #000000);
    padding-bottom: 60px;
    overflow-x: hidden;
    }

    .header {
    background: linear-gradient(135deg, #48c774 0%, #3abb67 100%);
    color: white;
    padding: 15px;
    text-align: center;
    position: sticky;
    top: 0;
    z-index: 100;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }

    .header h1 {
    font-size: 20px;
    font-weight: 600;
    }

    .daily-summary {
    background: var(--tg-theme-secondary-bg-color, #f8f9fa);
    padding: 15px;
    border-bottom: 1px solid var(--tg-theme-hint-color, #e0e0e0);
    }

    .date-selector {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 15px;
    }

    .date-nav {
    display: flex;
    align-items: center;
    gap: 15px;
    }

    .date-btn {
    background: var(--tg-theme-button-color, #48c774);
    color: white;
    border: none;
    width: 30px;
    height: 30px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    }

    .current-date {
    font-weight: 600;
    color: var(--tg-theme-text-color, #000);
    }

    .calories-ring {
    width: 120px;
    height: 120px;
    margin: 0 auto 15px;
    position: relative;
    }

    .calories-text {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    text-align: center;
    }

    .calories-value {
    font-size: 28px;
    font-weight: bold;
    color: var(--tg-theme-text-color, #000);
    }

    .calories-label {
    font-size: 12px;
    color: var(--tg-theme-hint-color, #999);
    }

    .macros-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 10px;
    }

    .macro-card {
    background: var(--tg-theme-bg-color, white);
    padding: 10px;
    border-radius: 10px;
    text-align: center;
    box-shadow: 0 2px 5px rgba(0,0,0,0.05);
    }

    .macro-value {
    font-size: 20px;
    font-weight: bold;
    }

    .macro-label {
    font-size: 11px;
    color: var(--tg-theme-hint-color, #999);
    margin-top: 2px;
    }

    .protein { color: #e74c3c; }
    .fats { color: #f39c12; }
    .carbs { color: #3498db; }

    .container {
    padding: 15px;
    }

    .quick-add {
    background: linear-gradient(135deg, #48c774 0%, #3abb67 100%);
    border-radius: 15px;
    padding: 15px;
    margin-bottom: 20px;
    box-shadow: 0 4px 15px rgba(72, 199, 116, 0.2);
    }

    .quick-add-title {
    color: white;
    font-weight: 600;
    margin-bottom: 10px;
    }

    .input-group {
    display: flex;
    gap: 10px;
    }

    .food-input {
    flex: 1;
    padding: 12px;
    border: none;
    border-radius: 10px;
    font-size: 16px;
    background: white;
    }

    .add-btn {
    padding: 12px 20px;
    background: white;
    color: #48c774;
    border: none;
    border-radius: 10px;
    font-weight: 600;
    cursor: pointer;
    }

    .meal-section {
    background: var(--tg-theme-bg-color, white);
    border-radius: 15px;
    padding: 15px;
    margin-bottom: 15px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.05);
    }

    .meal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 10px;
    padding-bottom: 10px;
    border-bottom: 1px solid var(--tg-theme-hint-color, #f0f0f0);
    }

    .meal-title {
    font-weight: 600;
    color: var(--tg-theme-text-color, #000);
    }

    .meal-calories {
    color: var(--tg-theme-hint-color, #666);
    font-size: 14px;
    }

    .food-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 10px;
    background: var(--tg-theme-secondary-bg-color, #f8f9fa);
    border-radius: 10px;
    margin-bottom: 8px;
    }

    .food-info {
    flex: 1;
    }

    .food-name {
    font-weight: 500;
    color: var(--tg-theme-text-color, #000);
    margin-bottom: 2px;
    }

    .food-details {
    font-size: 12px;
    color: var(--tg-theme-hint-color, #999);
    }

    .food-calories {
    font-weight: 600;
    color: #48c774;
    margin-right: 10px;
    }

    .delete-btn {
    background: #ff6b6b;
    color: white;
    border: none;
    width: 24px;
    height: 24px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    font-size: 12px;
    }

    .empty-meal {
    text-align: center;
    padding: 20px;
    color: var(--tg-theme-hint-color, #999);
    font-size: 14px;
    }

    .bottom-bar {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    background: var(--tg-theme-bg-color, white);
    border-top: 1px solid var(--tg-theme-hint-color, #e0e0e0);
    padding: 10px 15px;
    display: flex;
    gap: 10px;
    box-shadow: 0 -2px 10px rgba(0,0,0,0.05);
    }

    .tab-btn {
    flex: 1;
    padding: 8px;
    background: transparent;
    border: none;
    color: var(--tg-theme-hint-color, #999);
    font-size: 12px;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 4px;
    cursor: pointer;
    }

    .tab-btn.active {
    color: #48c774;
    }

    .tab-btn-icon {
    font-size: 20px;
    }

    .tab-content {
    display: none;
    }

    .tab-content.active {
    display: block;
    }

    .search-results {
    background: white;
    border-radius: 10px;
    margin-top: 10px;
    max-height: 200px;
    overflow-y: auto;
    box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    }

    .search-item {
    padding: 12px;
    border-bottom: 1px solid #f0f0f0;
    cursor: pointer;
    transition: background 0.2s;
    }

    .search-item:hover {
    background: #f8f9fa;
    }

    .search-item-name {
    font-weight: 500;
    margin-bottom: 2px;
    }

    .search-item-info {
    font-size: 12px;
    color: #999;
    }

    .loading {
    text-align: center;
    padding: 20px;
    color: var(--tg-theme-hint-color, #999);
    }

    .stats-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 15px;
    margin-bottom: 20px;
    }

    .stat-card {
    background: var(--tg-theme-bg-color, white);
    padding: 15px;
    border-radius: 12px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.05);
    }

    .stat-title {
    font-size: 12px;
    color: var(--tg-theme-hint-color, #999);
    margin-bottom: 5px;
    }

    .stat-value {
    font-size: 24px;
    font-weight: bold;
    color: #48c774;
    }

    .progress-bar {
    width: 100%;
    height: 8px;
    background: #f0f0f0;
    border-radius: 4px;
    overflow: hidden;
    margin-top: 8px;
    }

    .progress-fill {
    height: 100%;
    background: linear-gradient(90deg, #48c774 0%, #3abb67 100%);
    transition: width 0.3s;
    }
    </style>
</head>
<body>
    <div class="header">
    <h1>üçΩÔ∏è Food Tracker</h1>
    </div>

    <!-- –í–∫–ª–∞–¥–∫–∞ –¥–Ω–µ–≤–Ω–∏–∫–∞ –ø–∏—Ç–∞–Ω–∏—è -->
    <div id="diary-tab" class="tab-content active">
    <div class="daily-summary">
    <div class="date-selector">
    <div class="date-nav">
    <button class="date-btn" onclick="changeDate(-1)">‚Äπ</button>
    <span class="current-date" id="current-date">–°–µ–≥–æ–¥–Ω—è</span>
    <button class="date-btn" onclick="changeDate(1)">‚Ä∫</button>
    </div>
    </div>

    <div class="calories-ring">
    <svg width="120" height="120">
    <circle cx="60" cy="60" r="50" fill="none" stroke="#f0f0f0" stroke-width="10"/>
    <circle id="calories-progress" cx="60" cy="60" r="50" fill="none" stroke="#48c774" stroke-width="10"
    stroke-dasharray="314" stroke-dashoffset="314" transform="rotate(-90 60 60)"
    style="transition: stroke-dashoffset 0.5s"/>
    </svg>
    <div class="calories-text">
    <div class="calories-value" id="total-calories">0</div>
    <div class="calories-label">–∏–∑ <span id="target-calories">2000</span></div>
    </div>
    </div>

    <div class="macros-grid">
    <div class="macro-card">
    <div class="macro-value protein" id="total-protein">0–≥</div>
    <div class="macro-label">–ë–µ–ª–∫–∏</div>
    </div>
    <div class="macro-card">
    <div class="macro-value fats" id="total-fats">0–≥</div>
    <div class="macro-label">–ñ–∏—Ä—ã</div>
    </div>
    <div class="macro-card">
    <div class="macro-value carbs" id="total-carbs">0–≥</div>
    <div class="macro-label">–£–≥–ª–µ–≤–æ–¥—ã</div>
    </div>
    </div>
    </div>

    <div class="container">
    <div class="quick-add">
    <div class="quick-add-title">–ë—ã—Å—Ç—Ä–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ</div>
    <div class="input-group">
    <input type="text" class="food-input" id="food-input" 
    placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –æ–≤—Å—è–Ω–∫–∞ —Å –±–∞–Ω–∞–Ω–æ–º">
    <button class="add-btn" onclick="analyzeFood()">‚ûï</button>
    </div>
    <div id="search-results" class="search-results" style="display: none;"></div>
    </div>

    <div class="meal-section">
    <div class="meal-header">
    <span class="meal-title">üåÖ –ó–∞–≤—Ç—Ä–∞–∫</span>
    <span class="meal-calories" id="breakfast-calories">0 –∫–∫–∞–ª</span>
    </div>
    <div id="breakfast-items">
    <div class="empty-meal">–ù–∞–∂–º–∏—Ç–µ ‚ûï —á—Ç–æ–±—ã –¥–æ–±–∞–≤–∏—Ç—å</div>
    </div>
    </div>

    <div class="meal-section">
    <div class="meal-header">
    <span class="meal-title">‚òÄÔ∏è –û–±–µ–¥</span>
    <span class="meal-calories" id="lunch-calories">0 –∫–∫–∞–ª</span>
    </div>
    <div id="lunch-items">
    <div class="empty-meal">–ù–∞–∂–º–∏—Ç–µ ‚ûï —á—Ç–æ–±—ã –¥–æ–±–∞–≤–∏—Ç—å</div>
    </div>
    </div>

    <div class="meal-section">
    <div class="meal-header">
    <span class="meal-title">üåô –£–∂–∏–Ω</span>
    <span class="meal-calories" id="dinner-calories">0 –∫–∫–∞–ª</span>
    </div>
    <div id="dinner-items">
    <div class="empty-meal">–ù–∞–∂–º–∏—Ç–µ ‚ûï —á—Ç–æ–±—ã –¥–æ–±–∞–≤–∏—Ç—å</div>
    </div>
    </div>

    <div class="meal-section">
    <div class="meal-header">
    <span class="meal-title">üçé –ü–µ—Ä–µ–∫—É—Å—ã</span>
    <span class="meal-calories" id="snacks-calories">0 –∫–∫–∞–ª</span>
    </div>
    <div id="snacks-items">
    <div class="empty-meal">–ù–∞–∂–º–∏—Ç–µ ‚ûï —á—Ç–æ–±—ã –¥–æ–±–∞–≤–∏—Ç—å</div>
    </div>
    </div>
    </div>
    </div>

    <!-- –í–∫–ª–∞–¥–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ -->
    <div id="stats-tab" class="tab-content">
    <div class="container">
    <h3 style="margin-bottom: 15px;">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞ –Ω–µ–¥–µ–ª—é</h3>
    
    <div class="stats-grid">
    <div class="stat-card">
    <div class="stat-title">–°—Ä–µ–¥–Ω–∏–µ –∫–∞–ª–æ—Ä–∏–∏</div>
    <div class="stat-value" id="avg-calories">0</div>
    </div>
    <div class="stat-card">
    <div class="stat-title">–î–Ω–µ–π –∑–∞–ø–∏—Å–∞–Ω–æ</div>
    <div class="stat-value" id="days-tracked">0</div>
    </div>
    <div class="stat-card">
    <div class="stat-title">–°—Ä–µ–¥–Ω–∏–π –±–µ–ª–æ–∫</div>
    <div class="stat-value" id="avg-protein">0–≥</div>
    </div>
    <div class="stat-card">
    <div class="stat-title">–¶–µ–ª—å –¥–æ—Å—Ç–∏–≥–Ω—É—Ç–∞</div>
    <div class="stat-value" id="goal-days">0</div>
    </div>
    </div>

    <h3 style="margin-bottom: 15px;">–¢–æ–ø –ø—Ä–æ–¥—É–∫—Ç–æ–≤</h3>
    <div id="top-foods"></div>
    </div>
    </div>

    <!-- –í–∫–ª–∞–¥–∫–∞ –ø—Ä–æ–¥—É–∫—Ç–æ–≤ -->
    <div id="products-tab" class="tab-content">
    <div class="container">
    <div style="display: flex; gap: 10px; margin-bottom: 20px;">
    <input type="text" id="product-search" placeholder="–ü–æ–∏—Å–∫ –ø—Ä–æ–¥—É–∫—Ç–∞" 
    style="flex: 1; padding: 10px; border: 1px solid #e0e0e0; border-radius: 8px;">
    </div>
    <div id="products-list"></div>
    </div>
    </div>

    <!-- –í–∫–ª–∞–¥–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫ -->
    <div id="settings-tab" class="tab-content">
    <div class="container">
    <div class="meal-section">
    <h3 style="margin-bottom: 15px;">–î–Ω–µ–≤–Ω—ã–µ —Ü–µ–ª–∏</h3>
    
    <div style="margin-bottom: 15px;">
    <label style="display: block; margin-bottom: 5px; color: #666;">–ö–∞–ª–æ—Ä–∏–∏</label>
    <input type="number" id="target-calories-input" value="2000" 
    style="width: 100%; padding: 10px; border: 1px solid #e0e0e0; border-radius: 8px;">
    </div>
    
    <div style="margin-bottom: 15px;">
    <label style="display: block; margin-bottom: 5px; color: #666;">–ë–µ–ª–∫–∏ (–≥)</label>
    <input type="number" id="target-protein-input" value="150" 
    style="width: 100%; padding: 10px; border: 1px solid #e0e0e0; border-radius: 8px;">
    </div>
    
    <div style="margin-bottom: 15px;">
    <label style="display: block; margin-bottom: 5px; color: #666;">–ñ–∏—Ä—ã (–≥)</label>
    <input type="number" id="target-fats-input" value="70" 
    style="width: 100%; padding: 10px; border: 1px solid #e0e0e0; border-radius: 8px;">
    </div>
    
    <div style="margin-bottom: 15px;">
    <label style="display: block; margin-bottom: 5px; color: #666;">–£–≥–ª–µ–≤–æ–¥—ã (–≥)</label>
    <input type="number" id="target-carbs-input" value="250" 
    style="width: 100%; padding: 10px; border: 1px solid #e0e0e0; border-radius: 8px;">
    </div>
    
    <button class="add-btn" style="width: 100%; background: #48c774; color: white;" 
    onclick="saveSettings()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
    </div>
    </div>
    </div>

    <!-- –ù–∏–∂–Ω—è—è –ø–∞–Ω–µ–ª—å –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ -->
    <div class="bottom-bar">
    <button class="tab-btn active" onclick="showTab('diary')">
    <span class="tab-btn-icon">üìñ</span>
    <span>–î–Ω–µ–≤–Ω–∏–∫</span>
    </button>
    <button class="tab-btn" onclick="showTab('stats')">
    <span class="tab-btn-icon">üìä</span>
    <span>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</span>
    </button>
    <button class="tab-btn" onclick="showTab('products')">
    <span class="tab-btn-icon">ü•ó</span>
    <span>–ü—Ä–æ–¥—É–∫—Ç—ã</span>
    </button>
    <button class="tab-btn" onclick="showTab('settings')">
    <span class="tab-btn-icon">‚öôÔ∏è</span>
    <span>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</span>
    </button>
    </div>

    <script>
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram Web App
    const tg = window.Telegram.WebApp;
    tg.ready();
    tg.expand();

    // –ë–∞–∑–∞ –ø—Ä–æ–¥—É–∫—Ç–æ–≤ (—Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è)
    const foodDatabase = {
    // –ó–∞–≤—Ç—Ä–∞–∫–∏
    '–æ–≤—Å—è–Ω–∫–∞': { calories: 380, protein: 13, fats: 7, carbs: 67, per: 100 },
    '–æ–≤—Å—è–Ω–∞—è –∫–∞—à–∞': { calories: 380, protein: 13, fats: 7, carbs: 67, per: 100 },
    '–≥—Ä–µ—á–∫–∞': { calories: 343, protein: 13, fats: 3, carbs: 72, per: 100 },
    '–≥—Ä–µ—á–Ω–µ–≤–∞—è –∫–∞—à–∞': { calories: 132, protein: 4.5, fats: 2.3, carbs: 25, per: 100 },
    '—è–π—Ü–æ': { calories: 155, protein: 13, fats: 11, carbs: 1, per: 100 },
    '—è–∏—á–Ω–∏—Ü–∞': { calories: 240, protein: 14, fats: 20, carbs: 2, per: 100 },
    '–æ–º–ª–µ—Ç': { calories: 184, protein: 10, fats: 15, carbs: 2, per: 100 },
    '—Ç–≤–æ—Ä–æ–≥': { calories: 121, protein: 17, fats: 5, carbs: 3, per: 100 },
    '—Å—ã—Ä–Ω–∏–∫–∏': { calories: 220, protein: 12, fats: 8, carbs: 25, per: 100 },
    '–±–ª–∏–Ω—ã': { calories: 230, protein: 6, fats: 8, carbs: 34, per: 100 },
    
    // –§—Ä—É–∫—Ç—ã
    '–±–∞–Ω–∞–Ω': { calories: 89, protein: 1.1, fats: 0.3, carbs: 23, per: 100 },
    '—è–±–ª–æ–∫–æ': { calories: 52, protein: 0.3, fats: 0.2, carbs: 14, per: 100 },
    '–∞–ø–µ–ª—å—Å–∏–Ω': { calories: 47, protein: 0.9, fats: 0.1, carbs: 12, per: 100 },
    '–≥—Ä—É—à–∞': { calories: 57, protein: 0.4, fats: 0.1, carbs: 15, per: 100 },
    '–≤–∏–Ω–æ–≥—Ä–∞–¥': { calories: 67, protein: 0.6, fats: 0.2, carbs: 17, per: 100 },
    
    // –û–≤–æ—â–∏
    '–ø–æ–º–∏–¥–æ—Ä': { calories: 18, protein: 0.9, fats: 0.2, carbs: 3.9, per: 100 },
    '–æ–≥—É—Ä–µ—Ü': { calories: 16, protein: 0.7, fats: 0.1, carbs: 3.6, per: 100 },
    '–∫–∞–ø—É—Å—Ç–∞': { calories: 25, protein: 1.3, fats: 0.1, carbs: 6, per: 100 },
    '–º–æ—Ä–∫–æ–≤—å': { calories: 41, protein: 0.9, fats: 0.2, carbs: 10, per: 100 },
    '–∫–∞—Ä—Ç–æ—Ñ–µ–ª—å': { calories: 77, protein: 2, fats: 0.1, carbs: 17, per: 100 },
    '–∫–∞—Ä—Ç–æ—à–∫–∞': { calories: 77, protein: 2, fats: 0.1, carbs: 17, per: 100 },
    
    // –ú—è—Å–æ
    '–∫—É—Ä–∏—Ü–∞': { calories: 165, protein: 31, fats: 3.6, carbs: 0, per: 100 },
    '–∫—É—Ä–∏–Ω–∞—è –≥—Ä—É–¥–∫–∞': { calories: 165, protein: 31, fats: 3.6, carbs: 0, per: 100 },
    '–≥–æ–≤—è–¥–∏–Ω–∞': { calories: 250, protein: 26, fats: 15, carbs: 0, per: 100 },
    '—Å–≤–∏–Ω–∏–Ω–∞': { calories: 242, protein: 27, fats: 14, carbs: 0, per: 100 },
    '–∏–Ω–¥–µ–π–∫–∞': { calories: 189, protein: 29, fats: 7, carbs: 0, per: 100 },
    '–∫–æ—Ç–ª–µ—Ç–∞': { calories: 260, protein: 16, fats: 20, carbs: 5, per: 100 },
    
    // –†—ã–±–∞
    '–ª–æ—Å–æ—Å—å': { calories: 208, protein: 20, fats: 13, carbs: 0, per: 100 },
    '—Ç—É–Ω–µ—Ü': { calories: 144, protein: 23, fats: 5, carbs: 0, per: 100 },
    '—Ç—Ä–µ—Å–∫–∞': { calories: 82, protein: 18, fats: 0.7, carbs: 0, per: 100 },
    '—Å–∫—É–º–±—Ä–∏—è': { calories: 205, protein: 19, fats: 14, carbs: 0, per: 100 },
    
    // –ì–∞—Ä–Ω–∏—Ä—ã
    '—Ä–∏—Å': { calories: 130, protein: 2.7, fats: 0.3, carbs: 28, per: 100 },
    '–º–∞–∫–∞—Ä–æ–Ω—ã': { calories: 131, protein: 5, fats: 1.1, carbs: 25, per: 100 },
    '–ø–∞—Å—Ç–∞': { calories: 131, protein: 5, fats: 1.1, carbs: 25, per: 100 },
    
    // –°—É–ø—ã
    '–±–æ—Ä—â': { calories: 49, protein: 1.4, fats: 2.2, carbs: 6.7, per: 100 },
    '—Å—É–ø': { calories: 40, protein: 1.5, fats: 1.5, carbs: 5, per: 100 },
    '—â–∏': { calories: 31, protein: 1.6, fats: 1.1, carbs: 3.8, per: 100 },
    '—Å–æ–ª—è–Ω–∫–∞': { calories: 69, protein: 5.2, fats: 4.6, carbs: 1.7, per: 100 },
    
    // –ú–æ–ª–æ—á–Ω—ã–µ
    '–º–æ–ª–æ–∫–æ': { calories: 64, protein: 3.2, fats: 3.6, carbs: 4.8, per: 100 },
    '–∫–µ—Ñ–∏—Ä': { calories: 59, protein: 3, fats: 3.2, carbs: 4.1, per: 100 },
    '–π–æ–≥—É—Ä—Ç': { calories: 68, protein: 5, fats: 1.5, carbs: 8, per: 100 },
    '—Å—ã—Ä': { calories: 364, protein: 24, fats: 29, carbs: 0.5, per: 100 },
    '—Å–º–µ—Ç–∞–Ω–∞': { calories: 206, protein: 2.5, fats: 20, carbs: 3.4, per: 100 },
    
    // –•–ª–µ–±
    '—Ö–ª–µ–±': { calories: 265, protein: 9, fats: 3.2, carbs: 49, per: 100 },
    '—Ö–ª–µ–± —á–µ—Ä–Ω—ã–π': { calories: 201, protein: 6.6, fats: 1.2, carbs: 40, per: 100 },
    '—Ö–ª–µ–± –±–µ–ª—ã–π': { calories: 265, protein: 9, fats: 3.2, carbs: 49, per: 100 },
    
    // –ù–∞–ø–∏—Ç–∫–∏
    '–∫–æ—Ñ–µ': { calories: 2, protein: 0.2, fats: 0, carbs: 0.3, per: 100 },
    '—á–∞–π': { calories: 1, protein: 0.1, fats: 0, carbs: 0.3, per: 100 },
    '—Å–æ–∫': { calories: 45, protein: 0.5, fats: 0.1, carbs: 11, per: 100 },
    
    // –û—Ä–µ—Ö–∏
    '–æ—Ä–µ—Ö–∏': { calories: 600, protein: 20, fats: 50, carbs: 20, per: 100 },
    '–º–∏–Ω–¥–∞–ª—å': { calories: 579, protein: 21, fats: 49, carbs: 22, per: 100 },
    '–≥—Ä–µ—Ü–∫–∏–π –æ—Ä–µ—Ö': { calories: 654, protein: 15, fats: 65, carbs: 14, per: 100 },
    '–∞—Ä–∞—Ö–∏—Å': { calories: 567, protein: 26, fats: 49, carbs: 16, per: 100 }
    };

    let currentDate = new Date();
    let currentMeal = 'breakfast';
    let dailyData = {};
    let settings = {
    targetCalories: 2000,
    targetProtein: 150,
    targetFats: 70,
    targetCarbs: 250
    };

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
    document.addEventListener('DOMContentLoaded', function() {
    loadSettings();
    loadDailyData();
    updateDateDisplay();
    updateDailySummary();
    });

    function showTab(tabName) {
    document.querySelectorAll('.tab-content').forEach(tab => {
    tab.classList.remove('active');
    });
    document.getElementById(tabName + '-tab').classList.add('active');
    
    document.querySelectorAll('.tab-btn').forEach(btn => {
    btn.classList.remove('active');
    });
    event.currentTarget.classList.add('active');
    
    if (tabName === 'stats') {
    updateStats();
    } else if (tabName === 'products') {
    updateProductsList();
    }
    
    if (tg.HapticFeedback) {
    tg.HapticFeedback.impactOccurred('light');
    }
    }

    function changeDate(direction) {
    currentDate.setDate(currentDate.getDate() + direction);
    updateDateDisplay();
    loadDailyData();
    updateDailySummary();
    
    if (tg.HapticFeedback) {
    tg.HapticFeedback.impactOccurred('light');
    }
    }

    function updateDateDisplay() {
    const today = new Date();
    const isToday = currentDate.toDateString() === today.toDateString();
    const yesterday = new Date(today);
    yesterday.setDate(yesterday.getDate() - 1);
    const isYesterday = currentDate.toDateString() === yesterday.toDateString();
    
    let dateText;
    if (isToday) {
    dateText = '–°–µ–≥–æ–¥–Ω—è';
    } else if (isYesterday) {
    dateText = '–í—á–µ—Ä–∞';
    } else {
    dateText = currentDate.toLocaleDateString('ru-RU', { 
    day: 'numeric', 
    month: 'long' 
    });
    }
    
    document.getElementById('current-date').textContent = dateText;
    }

    function analyzeFood() {
    const input = document.getElementById('food-input');
    const text = input.value.toLowerCase().trim();
    
    if (!text) return;
    
    // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –≤—Ä–µ–º—è –ø—Ä–∏–µ–º–∞ –ø–∏—â–∏
    const hour = new Date().getHours();
    if (hour < 11) currentMeal = 'breakfast';
    else if (hour < 15) currentMeal = 'lunch';
    else if (hour < 20) currentMeal = 'dinner';
    else currentMeal = 'snacks';
    
    // –ü–∞—Ä—Å–∏–º —Ç–µ–∫—Å—Ç
    const foodItems = parseFood(text);
    
    if (foodItems.length > 0) {
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
    showSearchResults(foodItems);
    } else {
    tg.showAlert('–ù–µ —É–¥–∞–ª–æ—Å—å —Ä–∞—Å–ø–æ–∑–Ω–∞—Ç—å –ø—Ä–æ–¥—É–∫—Ç—ã. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –≤–≤–µ—Å—Ç–∏ –ø–æ-–¥—Ä—É–≥–æ–º—É.');
    }
    
    if (tg.HapticFeedback) {
    tg.HapticFeedback.impactOccurred('light');
    }
    }

    function parseFood(text) {
    const results = [];
    const words = text.split(/[\s,–∏]+/);
    
    // –ò—â–µ–º –ø—Ä–æ–¥—É–∫—Ç—ã –≤ –±–∞–∑–µ
    for (let food in foodDatabase) {
    if (text.includes(food)) {
    const data = foodDatabase[food];
    let amount = 100; // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é 100–≥
    
    // –ü—ã—Ç–∞–µ–º—Å—è –Ω–∞–π—Ç–∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ
    const amountMatch = text.match(/(\d+)\s*(–≥|–≥—Ä|–≥—Ä–∞–º–º|–º–ª|ml|—à—Ç|—à—Ç—É–∫|–ø–æ—Ä—Ü)/i);
    if (amountMatch) {
    amount = parseInt(amountMatch[1]);
    } else if (text.includes('—Ç–∞—Ä–µ–ª–∫') || text.includes('–ø–æ—Ä—Ü')) {
    amount = 250; // –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è –ø–æ—Ä—Ü–∏—è
    } else if (text.includes('—á–∞—à–∫') || text.includes('—Å—Ç–∞–∫–∞–Ω')) {
    amount = 200;
    } else if (text.includes('–ª–æ–∂–∫')) {
    amount = 20;
    }
    
    // –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–ª—É—á–∞–∏
    if (food === '—è–π—Ü–æ' && !amountMatch) {
    amount = 50; // –û–¥–Ω–æ —è–π—Ü–æ ~50–≥
    if (text.match(/(\d+)\s*(—à—Ç|—à—Ç—É–∫|—è–π)/)) {
    amount = 50 * parseInt(text.match(/(\d+)/)[1]);
    }
    }
    if (food === '–±–∞–Ω–∞–Ω' && !amountMatch) {
    amount = 120; // –°—Ä–µ–¥–Ω–∏–π –±–∞–Ω–∞–Ω
    }
    if (food === '—è–±–ª–æ–∫–æ' && !amountMatch) {
    amount = 150; // –°—Ä–µ–¥–Ω–µ–µ —è–±–ª–æ–∫–æ
    }
    
    const multiplier = amount / data.per;
    results.push({
    name: food,
    amount: amount,
    calories: Math.round(data.calories * multiplier),
    protein: Math.round(data.protein * multiplier * 10) / 10,
    fats: Math.round(data.fats * multiplier * 10) / 10,
    carbs: Math.round(data.carbs * multiplier * 10) / 10
    });
    }
    }
    
    return results;
    }

    function showSearchResults(items) {
    const resultsDiv = document.getElementById('search-results');
    resultsDiv.innerHTML = '';
    resultsDiv.style.display = 'block';
    
    items.forEach(item => {
    const div = document.createElement('div');
    div.className = 'search-item';
    div.innerHTML = `
    <div class="search-item-name">${item.name} (${item.amount}–≥)</div>
    <div class="search-item-info">
    ${item.calories} –∫–∫–∞–ª | –ë: ${item.protein}–≥ | –ñ: ${item.fats}–≥ | –£: ${item.carbs}–≥
    </div>
    `;
    div.onclick = () => addFoodItem(item);
    resultsDiv.appendChild(div);
    });
    
    // –î–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É "–î–æ–±–∞–≤–∏—Ç—å –≤—Å–µ"
    if (items.length > 1) {
    const addAllDiv = document.createElement('div');
    addAllDiv.className = 'search-item';
    addAllDiv.style.background = '#48c774';
    addAllDiv.style.color = 'white';
    addAllDiv.innerHTML = `
    <div class="search-item-name">–î–æ–±–∞–≤–∏—Ç—å –≤—Å–µ (${items.length} –ø—Ä–æ–¥—É–∫—Ç–æ–≤)</div>
    <div class="search-item-info">
    –í—Å–µ–≥–æ: ${items.reduce((sum, i) => sum + i.calories, 0)} –∫–∫–∞–ª
    </div>
    `;
    addAllDiv.onclick = () => {
    items.forEach(item => addFoodItem(item, false));
    updateDailySummary();
    document.getElementById('food-input').value = '';
    resultsDiv.style.display = 'none';
    tg.showPopup({
    title: '–î–æ–±–∞–≤–ª–µ–Ω–æ!',
    message: `–î–æ–±–∞–≤–ª–µ–Ω–æ ${items.length} –ø—Ä–æ–¥—É–∫—Ç–æ–≤`,
    buttons: [{type: 'ok'}]
    });
    };
    resultsDiv.appendChild(addAllDiv);
    }
    }

    function addFoodItem(item, showAlert = true) {
    const dateKey = currentDate.toISOString().split('T')[0];
    
    if (!dailyData[dateKey]) {
    dailyData[dateKey] = {
    breakfast: [],
    lunch: [],
    dinner: [],
    snacks: []
    };
    }
    
    dailyData[dateKey][currentMeal].push(item);
    saveDailyData();
    updateMealDisplay(currentMeal);
    updateDailySummary();
    
    document.getElementById('food-input').value = '';
    document.getElementById('search-results').style.display = 'none';
    
    if (showAlert) {
    tg.showPopup({
    title: '–î–æ–±–∞–≤–ª–µ–Ω–æ!',
    message: `${item.name} (${item.calories} –∫–∫–∞–ª)`,
    buttons: [{type: 'ok'}]
    });
    }
    
    if (tg.HapticFeedback) {
    tg.HapticFeedback.notificationOccurred('success');
    }
    }

    function updateMealDisplay(meal) {
    const dateKey = currentDate.toISOString().split('T')[0];
    const mealData = dailyData[dateKey]?.[meal] || [];
    const container = document.getElementById(`${meal}-items`);
    
    if (mealData.length === 0) {
    container.innerHTML = '<div class="empty-meal">–ù–∞–∂–º–∏—Ç–µ ‚ûï —á—Ç–æ–±—ã –¥–æ–±–∞–≤–∏—Ç—å</div>';
    } else {
    container.innerHTML = mealData.map((item, index) => `
    <div class="food-item">
    <div class="food-info">
    <div class="food-name">${item.name}</div>
    <div class="food-details">${item.amount}–≥ | –ë: ${item.protein}–≥ | –ñ: ${item.fats}–≥ | –£: ${item.carbs}–≥</div>
    </div>
    <span class="food-calories">${item.calories} –∫–∫–∞–ª</span>
    <button class="delete-btn" onclick="deleteFoodItem('${meal}', ${index})">‚úï</button>
    </div>
    `).join('');
    }
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –∫–∞–ª–æ—Ä–∏–∏ –ø—Ä–∏–µ–º–∞ –ø–∏—â–∏
    const totalCalories = mealData.reduce((sum, item) => sum + item.calories, 0);
    document.getElementById(`${meal}-calories`).textContent = `${totalCalories} –∫–∫–∞–ª`;
    }

    function deleteFoodItem(meal, index) {
    const dateKey = currentDate.toISOString().split('T')[0];
    dailyData[dateKey][meal].splice(index, 1);
    saveDailyData();
    updateMealDisplay(meal);
    updateDailySummary();
    
    if (tg.HapticFeedback) {
    tg.HapticFeedback.impactOccurred('warning');
    }
    }

    function updateDailySummary() {
    const dateKey = currentDate.toISOString().split('T')[0];
    const dayData = dailyData[dateKey] || { breakfast: [], lunch: [], dinner: [], snacks: [] };
    
    let totalCalories = 0;
    let totalProtein = 0;
    let totalFats = 0;
    let totalCarbs = 0;
    
    ['breakfast', 'lunch', 'dinner', 'snacks'].forEach(meal => {
    updateMealDisplay(meal);
    dayData[meal].forEach(item => {
    totalCalories += item.calories;
    totalProtein += item.protein;
    totalFats += item.fats;
    totalCarbs += item.carbs;
    });
    });
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
    document.getElementById('total-calories').textContent = totalCalories;
    document.getElementById('total-protein').textContent = Math.round(totalProtein) + '–≥';
    document.getElementById('total-fats').textContent = Math.round(totalFats) + '–≥';
    document.getElementById('total-carbs').textContent = Math.round(totalCarbs) + '–≥';
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å-–∫–æ–ª—å—Ü–æ
    const progress = Math.min(totalCalories / settings.targetCalories, 1);
    const circumference = 2 * Math.PI * 50;
    const offset = circumference - (progress * circumference);
    document.getElementById('calories-progress').style.strokeDashoffset = offset;
    
    // –¶–≤–µ—Ç –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
    const progressCircle = document.getElementById('calories-progress');
    if (progress > 1.1) {
    progressCircle.style.stroke = '#ff6b6b';
    } else if (progress > 0.9) {
    progressCircle.style.stroke = '#ffd93d';
    } else {
    progressCircle.style.stroke = '#48c774';
    }
    }

    function updateStats() {
    const last7Days = [];
    for (let i = 0; i < 7; i++) {
    const date = new Date();
    date.setDate(date.getDate() - i);
    const dateKey = date.toISOString().split('T')[0];
    if (dailyData[dateKey]) {
    last7Days.push(dailyData[dateKey]);
    }
    }
    
    if (last7Days.length === 0) {
    document.getElementById('avg-calories').textContent = '0';
    document.getElementById('days-tracked').textContent = '0';
    document.getElementById('avg-protein').textContent = '0–≥';
    document.getElementById('goal-days').textContent = '0';
    return;
    }
    
    let totalCalories = 0;
    let totalProtein = 0;
    let goalDays = 0;
    const foodCount = {};
    
    last7Days.forEach(day => {
    let dayCalories = 0;
    let dayProtein = 0;
    
    ['breakfast', 'lunch', 'dinner', 'snacks'].forEach(meal => {
    day[meal].forEach(item => {
    dayCalories += item.calories;
    dayProtein += item.protein;
    foodCount[item.name] = (foodCount[item.name] || 0) + 1;
    });
    });
    
    totalCalories += dayCalories;
    totalProtein += dayProtein;
    
    if (dayCalories >= settings.targetCalories * 0.9 && 
    dayCalories <= settings.targetCalories * 1.1) {
    goalDays++;
    }
    });
    
    document.getElementById('avg-calories').textContent = Math.round(totalCalories / last7Days.length);
    document.getElementById('days-tracked').textContent = last7Days.length;
    document.getElementById('avg-protein').textContent = Math.round(totalProtein / last7Days.length) + '–≥';
    document.getElementById('goal-days').textContent = goalDays;
    
    // –¢–æ–ø –ø—Ä–æ–¥—É–∫—Ç–æ–≤
    const topFoods = Object.entries(foodCount)
    .sort((a, b) => b[1] - a[1])
    .slice(0, 5);
    
    const topFoodsHtml = topFoods.map(([name, count]) => `
    <div class="food-item">
    <span>${name}</span>
    <span>${count} —Ä–∞–∑</span>
    </div>
    `).join('');
    
    document.getElementById('top-foods').innerHTML = topFoodsHtml || '<div class="empty-meal">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö</div>';
    }

    function updateProductsList() {
        const searchInput = document.getElementById('product-search');
        const searchTerm = searchInput ? searchInput.value.toLowerCase() : '';
        const productsList = document.getElementById('products-list');
        
        productsList.innerHTML = '';
        
        for (let food in foodDatabase) {
            if (!searchTerm || food.includes(searchTerm)) {
                const data = foodDatabase[food];
                const div = document.createElement('div');
                div.className = 'food-item';
                div.innerHTML = `
                    <div class="food-info">
                        <div class="food-name">${food}</div>
                        <div class="food-details">–Ω–∞ 100–≥: ${data.calories} –∫–∫–∞–ª | –ë: ${data.protein}–≥ | –ñ: ${data.fats}–≥ | –£: ${data.carbs}–≥</div>
                    </div>
                `;
                productsList.appendChild(div);
            }
        }
    }

    function saveSettings() {
        settings.targetCalories = parseInt(document.getElementById('target-calories-input').value) || 2000;
        settings.targetProtein = parseInt(document.getElementById('target-protein-input').value) || 150;
        settings.targetFats = parseInt(document.getElementById('target-fats-input').value) || 70;
        settings.targetCarbs = parseInt(document.getElementById('target-carbs-input').value) || 250;
        
        tg.CloudStorage.setItem('food_settings', JSON.stringify(settings));
        
        document.getElementById('target-calories').textContent = settings.targetCalories;
        updateDailySummary();
        
        tg.showPopup({
            title: '–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ!',
            message: '–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –æ–±–Ω–æ–≤–ª–µ–Ω—ã',
            buttons: [{type: 'ok'}]
        });
    }

    function loadSettings() {
        tg.CloudStorage.getItem('food_settings', (error, value) => {
            if (value) {
                try {
                    settings = JSON.parse(value);
                    document.getElementById('target-calories').textContent = settings.targetCalories;
                    document.getElementById('target-calories-input').value = settings.targetCalories;
                    document.getElementById('target-protein-input').value = settings.targetProtein;
                    document.getElementById('target-fats-input').value = settings.targetFats;
                    document.getElementById('target-carbs-input').value = settings.targetCarbs;
                } catch (e) {
                    console.error('Error loading settings:', e);
                }
            }
        });
    }

    function saveDailyData() {
        const dateKey = currentDate.toISOString().split('T')[0];
        tg.CloudStorage.setItem(`food_${dateKey}`, JSON.stringify(dailyData[dateKey]));
    }

    function loadDailyData() {
        const dateKey = currentDate.toISOString().split('T')[0];
        tg.CloudStorage.getItem(`food_${dateKey}`, (error, value) => {
            if (value) {
                try {
                    dailyData[dateKey] = JSON.parse(value);
                } catch (e) {
                    console.error('Error loading daily data:', e);
                    dailyData[dateKey] = { breakfast: [], lunch: [], dinner: [], snacks: [] };
                }
            } else {
                dailyData[dateKey] = { breakfast: [], lunch: [], dinner: [], snacks: [] };
            }
            updateDailySummary();
        });
    }

    // –ü–æ–∏—Å–∫ –ø—Ä–æ–¥—É–∫—Ç–æ–≤ –ø—Ä–∏ –≤–≤–æ–¥–µ
    document.getElementById('product-search')?.addEventListener('input', updateProductsList);